<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Chana Intel PWA</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.65.1/build/stlite.css" />
    <link rel="manifest" href="./manifest.json" />
    <style>
      html, body, #root { font-family: 'Helvetica', sans-serif; background-color: #f0f2f6; }
      /* Adds a loading message so you know it's working on iPhone */
      #loading { 
        display: flex; justify-content: center; align-items: center; 
        height: 100vh; font-family: Helvetica; color: #555;
      }
    </style>
  </head>
  <body>
    <div id="loading">ğŸŒ¾ Loading Chana Intelligence... Please wait 60s</div>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.65.1/build/stlite.js"></script>
    <script>
      stlite.mount({
        requirements: ["pandas", "matplotlib"],
        entrypoint: "app.py",
        files: {
          "app.py": `
import streamlit as st
import pandas as pd
from datetime import datetime

st.set_page_config(page_title="Chana Intel", layout="wide")

# Remove the loading message once Python starts
st.markdown("<style>#loading {display: none !important;}</style>", unsafe_allow_html=True)

# Helvetica Font Enforcement
st.markdown("<style>html, body, [class*='st-'] {font-family: 'Helvetica', sans-serif;}</style>", unsafe_allow_html=True)

# Header
col_t, col_r = st.columns([4, 1])
with col_t:
    st.title("ğŸŒ¾ Chana Intelligence Report")
    st.caption(f"Last Updated: {datetime.now().strftime('%d %b %Y | %H:%M')}")
with col_r:
    if st.button("ğŸ”„ Refresh"):
        st.rerun()

st.markdown("---")

# Prices Table
st.header("ğŸ“ˆ NCDEX Spot Price Tracker")
df = pd.DataFrame({
    "Location": ["Bikaner", "Delhi", "Akola"],
    "Today": [5575.0, 5745.6, 5400.0],
    "Change": ["+1.36%", "+0.76%", "-0.69%"],
    "Status": ["ğŸŸ© Gain", "ğŸŸ© Firm", "ğŸŸ¦ Soft"]
})
st.table(df)

st.divider()

# Weather & Advisory
st.header("ğŸŒ¡ï¸ Weather & Crop Outlook")
c1, c2 = st.columns(2)
with c1:
    st.metric("Bikaner Max", "31.0Â°C", "+3.0Â°C")
    st.info("Stage: Reproductive")
with c2:
    st.metric("Sehore Max", "33.0Â°C", "+3.0Â°C")
    st.warning("Risk: Terminal Heat")

st.success("**Advisory:** Apply light irrigation to cool the crop canopy.")
          `
        }
      }, document.getElementById("root"));
    </script>
  </body>
</html>
