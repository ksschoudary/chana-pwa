<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Chana Intel PWA</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.65.1/build/stlite.css" />
    <link rel="manifest" href="./manifest.json" />
    <style>
      /* This forces the Helvetica font across the entire app */
      html, body, [class*="css"]  {
        font-family: 'Helvetica', 'Arial', sans-serif !important;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.65.1/build/stlite.js"></script>
    <script>
      stlite.mount({
        requirements: ["pandas", "matplotlib"],
        entrypoint: "app.py",
        files: {
          "app.py": `
import streamlit as st
import pandas as pd
from datetime import datetime
import time

# 1. Page Config & Helvetica Styling
st.set_page_config(page_title="Chana Intelligence", layout="wide")

# Custom CSS for font enforcement inside Streamlit
st.markdown("""
    <style>
    html, body, [class*="st-"] {
        font-family: 'Helvetica', sans-serif;
    }
    </style>
    """, unsafe_allow_html=True)

# 2. Header & Refresh Logic
col_title, col_refresh = st.columns([4, 1])

with col_title:
    st.title("ðŸŒ¾ Chana Crop Intelligence Report")
    # Dynamically shows the current time as "Last Updated"
    current_time = datetime.now().strftime("%d %b %Y | %H:%M:%S")
    st.caption(f"Last Updated: {current_time}")

with col_refresh:
    if st.button("ðŸ”„ Refresh Now"):
        with st.spinner("Fetching latest data..."):
            time.sleep(1) # Simulates a quick data fetch
            st.rerun()

st.markdown("---")

# --- SECTION 1: NCDEX SPOT PRICES ---
st.header("ðŸ“ˆ NCDEX Spot Price Tracker (Chana)")
price_data = {
    "Location": ["Bikaner", "Delhi", "Akola"],
    "Today Price (â‚¹/Q)": [5575.0, 5745.6, 5400.0],
    "Y'day Price (â‚¹/Q)": [5500.0, 5702.1, 5437.5],
    "% Change": ["+1.36%", "+0.76%", "-0.69%"],
    "Market Status": ["ðŸŸ© Strong Gain", "ðŸŸ© Firming Up", "ðŸŸ¦ Softening"]
}
st.table(pd.DataFrame(price_data))

st.divider()

# --- SECTION 2: WEATHER ANALYSIS ---
st.header("ðŸŒ¡ï¸ Temperature & Weather Analysis")
c_weather1, c_weather2 = st.columns(2)
with c_weather1:
    st.subheader("Bikaner (Rajasthan)")
    st.metric("Max Temp Today", "31.0Â°C", "Departure +3.0Â°C")
with c_weather2:
    st.subheader("Sehore (Madhya Pradesh)")
    st.metric("Max Temp Today", "33.0Â°C", "Departure +3.0Â°C")

st.divider()

# --- SECTION 3: CROP FRONT ---
st.header("ðŸ§¬ Phenology & Crop Front")
st.info("**Stage:** Reproductive to early Grain Filling")
st.write("ICAR-CRIDA warns of 'forced maturity'. Night temps >16Â°C prevent recovery.")

st.divider()

# --- SECTION 4: ADVISORY ---
st.header("ðŸ©º Agromet Advisory")
st.success("**Irrigation:** Light irrigation recommended for cooling.")
st.warning("**Heat:** Foliar spray of Potassium Nitrate @ 1% advised.")

st.markdown("---")
st.caption("Data Sources: NCDEX, IMD, ICAR-CRIDA")
          `
        }
      }, document.getElementById("root"));
    </script>
  </body>
</html>
